# 2020/12

## 02
[extension Dateで日付計算をしてはいけない \- Qiita](https://qiita.com/takasek/items/1ecd7f2cd7e0d08354eb)

## Swift
Appleが開発したPG言語でApple Watch向けのアプリ開発などで使用されている。

### なぜextension Dateから日付を取得してはダメなのか

```swift
extension Date {
    var year: Int {
        Calendar.current.component(.year, from: self)
    }
    var month: Int {
        Calendar.current.component(.month, from: self)
    }
    var day: Int {
        Calendar.current.component(.day, from: self)
    }
    var hyphened: String {
        String(format: "%04d-%02d-%02d", year, month, day)
    }
}

let now = Date()
now.year // 2020
now.month // 12
now.day // 2
now.hyphened // "2020-12-02"
```
上記はextension Dateの使用を誤った悪い例。  
Dateメソッドはdate同士の比較やインターバルの計算の用途で使用されるメソッドなので「Calendar」メソッドを使用する方が適している。

### まとめ
結果だけ出力できれば良いという考え方だと、その過程で躓いていたなどという事例があり得るので本記事のように日付を求める際はこのメソッドで正しいかなどきちんと精査してPG開発を行おうと考えました。

## 07
[C\# Excel数式を作成・取得 \- Qiita](https://qiita.com/iceblue/items/ffbc5d4756f436abf5c4)

### PG内容

```c#
using Spire.Xls;

namespace ConsoleApplication28
{
    class Program
    {
        static void Main(string[] args)
        {

            //Workbookを作成します。
            Workbook workbook = new Workbook();
            Worksheet sheet = workbook.Worksheets[0];

            //currentRow、currentFormulaを初期化します。
            int currentRow = 1;
            string currentFormula = string.Empty;

            //1、2列の幅をせってします。
            sheet.SetColumnWidth(1, 32);
            sheet.SetColumnWidth(2, 16);

            //データを追加します。
            sheet.Range[currentRow, 1].Value = "テストデータ：";
            sheet.Range[currentRow, 2].NumberValue = 1;
            sheet.Range[currentRow, 3].NumberValue = 2; ;
            sheet.Range[currentRow, 4].NumberValue = 3;
            sheet.Range[currentRow, 5].NumberValue = 4;
            sheet.Range[currentRow, 6].NumberValue = 5;

            //テキストを追加します。
            currentRow += 2;
            sheet.Range[currentRow, 1].Value = "数式"; ;
            sheet.Range[currentRow, 2].Value = "結果";
            CellRange range = sheet.Range[currentRow, 1, currentRow, 2];
            range.Style.Font.IsBold = true;
            range.Style.KnownColor = ExcelColors.LightGreen1;
            range.Style.FillPattern = ExcelPatternType.Solid;
            range.Style.Borders[BordersLineType.EdgeBottom].LineStyle = LineStyleType.Medium;

            //演算子を行います。
            currentFormula = "=1/2+3*4";
            sheet.Range[++currentRow, 1].Text = currentFormula;
            sheet.Range[currentRow, 2].Formula = currentFormula;

            //日付関数
            currentFormula = "=TODAY()";
            sheet.Range[++currentRow, 1].Text = currentFormula;
            sheet.Range[currentRow, 2].Formula = currentFormula;
            sheet.Range[currentRow, 2].Style.NumberFormat = "YYYY/MM/DD";

            //時間関数
            currentFormula = "=NOW()";
            sheet.Range[++currentRow, 1].Text = currentFormula;
            sheet.Range[currentRow, 2].Formula = currentFormula;
            sheet.Range[currentRow, 2].Style.NumberFormat = "H:MM AM/PM";

            //IF関数
            currentFormula = "=IF(B1=5,\"Yes\",\"No\")";
            sheet.Range[++currentRow, 1].Text = currentFormula;
            sheet.Range[currentRow, 2].Formula = currentFormula;

            //PI関数
            currentFormula = "=PI()";
            sheet.Range[++currentRow, 1].Text = currentFormula;
            sheet.Range[currentRow, 2].Formula = currentFormula;

            //三角関数
            currentFormula = "=SIN(PI()/6)";
            sheet.Range[++currentRow, 1].Text = currentFormula;
            sheet.Range[currentRow, 2].Formula = currentFormula;

            //COUNT関数
            currentFormula = "=Count(B1:F1)";
            sheet.Range[++currentRow, 1].Text = currentFormula;
            sheet.Range[currentRow, 2].Formula = currentFormula;

            //MAX関数
            currentFormula = "=MAX(B1:F1)";
            sheet.Range[++currentRow, 1].Text = currentFormula;
            sheet.Range[currentRow, 2].Formula = currentFormula;

            //AVERAGE関数
            currentFormula = "=AVERAGE(B1:F1)";
            sheet.Range[++currentRow, 1].Text = currentFormula;
            sheet.Range[currentRow, 2].Formula = currentFormula;

            //SUM関数
            currentFormula = "=SUM(B1:F1)";
            sheet.Range[++currentRow, 1].Text = currentFormula;
            sheet.Range[currentRow, 2].Formula = currentFormula;

            //保存します。
            workbook.SaveToFile("Excel数式.xlsx", FileFormat.Version2013);
        }
    }
}
```
EXCELのブックを作成して左に数式、右に結果を出力するPG。

```c#
using Spire.Xls;
using System;

namespace ConsoleApplication
{
    class Program
    {
        static void Main(string[] args)
        {

            //Workbook作成します。
            Workbook workbook = new Workbook();

            //Excelをロードします。
            workbook.LoadFromFile("Excel数式.xlsx");

            //シートを取得します。
            Worksheet sheet = workbook.Worksheets[0];

            //[B1：B13]のセルをループします。
            foreach (var cell in sheet.Range["B1:B13"])
            {
                //数式があるかどうか判定します。
                if (cell.HasFormula)
                {
                    //数式のあるセルを出力します。
                    string certainCell = String.Format("Cell[{0},{1}]", cell.Row, cell.Column);
                    Console.WriteLine(certainCell + " 数式あり： " + cell.Formula);
                }
            }
        }
    }
}
```
EXCELから数式の入ったセルから数式を抽出して出力結果を画面に表示するPG。

### まとめ
ある程度決まった規則で作成されたEXCELならば必要な情報を抜き出すことが比較的容易。